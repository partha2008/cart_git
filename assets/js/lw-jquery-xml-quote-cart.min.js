/*! 
    jQuery XML Product Showcase & Quote Cart
    by LivelyWorks - http://livelyworks.net
    Ver. 1.0.1
*/
$(document).ready(function(){"use strict";_.templateSettings.variable="_oData";var t={configXMLFile:"data-provider/config.xml",productsXMLFile:"data-provider/products.xml",storeName:"",logoImage:"",businessEmail:"",searchProductDetails:!0,bs3Theme:$("body").hasClass("bs-3")?!0:!1,submitRequestBaseURL:"scripts/cart-mailer.php?",messages:{},enableQuoteCart:!0},e={},a={},o={},r={},n={},i=new Array,s=new Date,d={},u=!1,c={categoryIdentfierInURL:"uid-",isStoreLoaded:!1,lastAccessedCategory:null,hashChanged:!1,preventHashChangedAction:!1,cartStorageName:"store-cart-storage"+window.location.hostname,qtyUpdateTimeout:null,searchDelayTimeout:null,showSubmitRequestTimeout:null,enableOrderBtn:!1,isDemoActivate:!0,preventHashChange:!1,lastBreadcrumb:null},l={storeLogo:$("#storeLogo"),checkoutSubmitRequestBtn:$("#checkoutSubmitRequest"),loaderContainer:$("#loaderContainer"),mainContainer:$("#mainContainer"),modalCommon:$("#commonModal"),modalContainer:$(t.bs3Theme?".common-modal-content":"#commonModal"),categoriesList:$("#categoriesList"),storeLoaderStatusText:$(".lw-loading-status"),productsContainer:$("#productsContainer"),storeWaitingText:$(".lw-waiting-text"),addToCartBtnContainer:$("#addToCartBtnContainer"),productsBreadcrumb:$("#productsBreadcrumb"),shoppingCartBtnContainer:$(".quote-cart-btn-container"),searchInput:$("input.search-product"),clearSearchBtn:$(".clear-search-result-btn"),footerStoreName:$(".footer-store-name"),goToTop:$(".go-to-top"),searchedProductCounts:$("#searchedProductCounts"),showQuoteCartBtn:$(".quote-cart-btn-wrapper")},m={sidebarCategories:_.template($("script.sidebar-catgegories-template").html()),productsGrid:_.template($("script.products-grid-template").html()),productsDetailsModal:_.template($("script.products-details-modal-template").html()),shoppingCartModal:_.template($("script.quote-cart-template").html()),addToCartBtn:_.template($("script.add-to-cart-btn-template").html()),productAddToCartBtn:_.template($("script.products-grid-add-to-cart-btn-template").html()),shoppingCartBtn:_.template($("script.quote-cart-btn-template").html()),submitRequestFormModal:_.template($("script.submit-request-form-template").html()),productsBreadcrumb:_.template($("script.product-breadcrumb-template").html()),searchResultStatusText:_.template($("script.search-result-status-text-template").html())},p={convertToSlug:function(t){return t.toLowerCase().replace(/ /g,"-").replace(/[^\w-]+/g,"")},dataFromURL:function(){return _.object(_.compact(_.map(location.hash.slice(1).split("/"),function(t){return t?t.split("id-"):void 0})))},goToTop:function(t){t&&t.preventDefault(),$("html, body").animate({scrollTop:"0px"},{duration:150,easing:"swing"})},goToTopModel:function(t){t&&t.preventDefault(),$(".modal").animate({scrollTop:"0px"},{duration:150,easing:"swing"})},resizeNPositioin:function(){$("head").append("<style> .bs-2 .modal-body { max-height:"+.4*$(window).height()+"px;} </style>"),l.loaderContainer.css({top:.5*$(window).height()-.5*l.loaderContainer.height(),left:.5*$(window).width()-.5*l.loaderContainer.width()})}};p.resizeNPositioin(),l.storeLoaderStatusText.html("Loading configurations..."),$.ajax({type:"GET",url:t.configXMLFile+"?file="+s.getTime(),dataType:"xml",success:function(o){l.storeLoaderStatusText.html("Loading loaded...");var r=$(o).find("configuration")[0],n=$(r).find("messages")[0],i=$(n).find("order_submission")[0],d=$(i).find("success"),u=$(i).find("failed");t.messages={init:$(n).attr("init"),loading:$(n).attr("loading"),configLoading:$(n).attr("configLoading"),order:{success_header:$(d).attr("header"),failed_header:$(u).attr("header"),success:$(i).find("success").text(),failed:$(i).find("failed").text()}},t.logoImage=$(r).attr("logoImage"),t.storeName=$(r).attr("storeName"),l.footerStoreName.html(t.storeName),$(r).attr("enableQuoteCart")&&(t.enableQuoteCart=parseInt($(r).attr("enableQuoteCart"))),$(r).attr("businessEmail")&&(t.businessEmail=$(r).attr("businessEmail")),l.storeLogo.attr("src",t.logoImage),0==t.useSubmitRequestByEmail&&l.checkoutSubmitRequestBtn.hide(),t.enableQuoteCart?$(".quote-cart-btn-wrapper").show():$(".quote-cart-btn-wrapper").hide(),t.submitRequestBaseURL=t.submitRequestBaseURL+"&business="+t.businessEmail,l.storeLoaderStatusText.html("Loading products data..."),$.ajax({type:"GET",url:t.productsXMLFile+"?file="+s.getTime(),dataType:"xml",success:function(t){$("#mainContainer").show(),l.storeLoaderStatusText.html("Intializating ...");var o=0,r=0;$(t).find("category").each(function(){var t=$(this),n=t.attr("categoryName"),i=t.attr("categoryID")?p.convertToSlug(t.attr("categoryID")):o;a[i]={name:n,index:i,slug:p.convertToSlug(n),count:$(t).find("product").length},t.find("product").each(function(){{var t=$(this),a=t.attr("productName"),o=t.attr("productID")?p.convertToSlug(t.attr("productID")):r;e[o]={name:a,slug:p.convertToSlug(a),thumbPath:t.attr("thumbPath"),id:t.attr("productID"),index:o,categoryIndex:i,details:t.find("details").text()}}r++}),o++}),$(".lw-all-category-badge").text(r),h.loadExistingCartItems()}}).fail(function(t){l.storeWaitingText.html("products loading failed!!"),l.storeLoaderStatusText.html(t.statusText)})}}).fail(function(t){l.storeWaitingText.html("configuration loading failed!!"),l.storeLoaderStatusText.html(t.statusText)});var h={setupCategories:function(){l.categoriesList.find(".active-category").after(m.sidebarCategories({categoriesCollection:a})),h.setupStore()},loadExistingCartItems:function(){var t=$.jStorage.get(c.cartStorageName),e=$.parseJSON(t);e&&e.length&&(i=e),h.updateCart(),h.setupCategories()},setupStore:function(){h.onAllComplete(),_.delay(h.updateCart,500)},categoryLinkAction:function(){c.preventHashChangedAction=!1},loadCategoryProducts:function(t){h.clearSearchResult(!0),"all"==t?(o=e,h.updateBreadCrumb("all")):(o=_.filter(e,function(e){return e.categoryIndex==t?e:void 0}),h.updateBreadCrumb(a[t])),p.goToTop(),l.categoriesList.find("li").removeClass("active-category"),l.categoriesList.find(".category-list-item-"+t).addClass("active-category"),c.lastAccessedCategory=t,h.generateProductsThumbs()},generateProductsThumbs:function(){l.productsContainer.data("masonry")&&l.productsContainer.masonry("destroy"),l.productsContainer.html(m.productsGrid({currentProductCollection:o})),l.storeLoaderStatusText.remove(),l.loaderContainer.show(),l.productsContainer.imagesLoaded(function(){l.productsContainer.masonry({itemSelector:".product-item",gutter:10}),$(".product-item").addClass("fade-in"),l.loaderContainer.hide(),h.updateAddToCartBtns()})},onSearch:function(){clearTimeout(c.searchDelayTimeout),c.searchDelayTimeout=setTimeout(function(){if(""==l.searchInput.val())return!1;l.clearSearchBtn.removeAttr("disabled");var t=p.dataFromURL();if(t.hasOwnProperty("search")){if(c.preventHashChangedAction)return c.preventHashChangedAction=!1,!1;h.searchProduct()}else location.hash="#/search"},300)},clearSearchResult:function(t){l.searchInput.val(""),l.clearSearchBtn.attr("disabled",""),l.searchedProductCounts.html("").removeClass("lw-show-result"),t||h.searchProduct()},searchProduct:function(){l.categoriesList.find("li").removeClass("active-category");var a=l.searchInput.val(),r=a.toLowerCase().split(" ");n=e;for(var i=[],s=0;s<r.length;s++){var d=r[s];i=[];for(var u in n){var p=n[u],C=p.name.toLowerCase();t.searchProductDetails&&(C+=p.details.toLowerCase()),C.indexOf(d)>-1&&i.push(p)}n=i}c.lastAccessedCategory="search",l.searchedProductCounts.html(m.searchResultStatusText({searchedItemsFound:n.length})).addClass("lw-show-result"),_.isEqual(o,n)||(o=n,h.generateProductsThumbs())},productDetails:function(o){return(r=e[o])?(u=h.itemExistInCart(),l.modalContainer.html(m.productsDetailsModal({oCurrentProductData:r,categoriesCollection:a,enableQuoteCart:t.enableQuoteCart})),h.updateAddToCartBtn(),void h.openModal()):!1},showShoppingCart:function(a){return l.modalContainer.html(m.shoppingCartModal({cartProductsCollection:i,allProductsCollection:e,configOptions:t,fnMisc:p,generalVars:c,cartStats:d})),a&&a.preventModelReLoad?!1:(h.openModal(),h.updateAddToCartBtn(),void(c.isStoreLoaded||h.loadCategoryProducts("all")))},backFromModal:function(){return l.mainContainer.removeClass("main-container-addtions"),c.preventHashChange?(c.preventHashChange=!1,!1):(c.preventHashChangedAction=!0,void(location.hash="search"==c.lastAccessedCategory?"#/search":"#/category/uid-"+c.lastAccessedCategory))},addToCart:function(t){t.preventDefault();for(var e in i){var a=i[e];if(a.index==r.index)return a.qty++,h.updateCart(),h.updateAddToCartBtn()}return i.push({index:r.index,qty:1}),h.updateCart(),h.updateAddToCartBtn()},productAddToCart:function(t){t.preventDefault();{var e=$(this),a=e.data("productindex");h.itemExistInCart(a),o[a]}h.showDynamicCartShowBtn();for(var r in i){var n=i[r];if(n.index==a)return n.qty++,h.updateCart(),h.updateAddToCartBtn()}return i.push({index:a,qty:1}),h.updateCart(),h.updateAddToCartBtn()},showDynamicCartShowBtnDelay:!1,showDynamicCartShowBtn:function(){clearTimeout(h.showDynamicCartShowBtnDelay),$(".dynamic-show-cart-btn").animate({right:"-2px"},{duration:500,easing:"swing"}),h.showDynamicCartShowBtnDelay=setTimeout(function(){$(".dynamic-show-cart-btn").animate({right:"-400px"},{duration:500,easing:"swing"})},4e3)},updateCart:function(){d.totalItems=0,$.jStorage.set(c.cartStorageName,$.toJSON(i));for(var t in i){var a=i[t],o=e[a.index];if(!o){i=new Array;break}d.totalItems+=a.qty}c.enableOrderBtn=i.length>0?!0:!1,h.updateAddToCartBtns()},updateAddToCartBtnsDelay:!1,updateAddToCartBtns:function(){clearTimeout(h.updateAddToCartBtnsDelay),h.updateAddToCartBtnsDelay=setTimeout(function(){l.shoppingCartBtnContainer.html(m.shoppingCartBtn({cartStats:d,enableQuoteCart:t.enableQuoteCart}));for(var a in e){var o=e[a],r=_.where(i,{index:a});r=r[0],l.productsContainer.find(".product-add-to-cart-btn-container-"+o.index).html(r&&_.isObject(r)?m.productAddToCartBtn({thisProductInCart:r.qty,listItem:o,enableQuoteCart:t.enableQuoteCart}):m.productAddToCartBtn({thisProductInCart:0,listItem:o,enableQuoteCart:t.enableQuoteCart}))}},200)},updateCartItemQty:function(){clearTimeout(c.qtyUpdateTimeout);var t=$(this),e=new Number(t.val()),a=t.data("cartrowindex");return 1>e?(t.val(1),!1):void(c.qtyUpdateTimeout=setTimeout(function(){i[a].qty=e,h.updateCart(),h.showShoppingCart({preventModelReLoad:!0})},300))},removeCartItem:function(){var t=$(this).data("cartrowindex");i.splice(t,1),h.updateCart(),h.showShoppingCart({preventModelReLoad:!0})},updateAddToCartBtn:function(){return l.addToCartBtnContainer=$("#addToCartBtnContainer"),u=h.itemExistInCart(),l.addToCartBtnContainer.html(m.addToCartBtn({nProductInCart:u})),u},itemExistInCart:function(t){var e=r.index;t&&(e=t);for(var a in i){var o=i[a];if(o.index==e)return o.qty}return!1},updateBreadCrumbOnOver:function(){var t=$(this).data("productindex"),o=e[t],r=a[o.categoryIndex];h.updateBreadCrumb(r,o)},updateBreadCrumb:function(t,e){var a=t.index;return e&&(a+="-"+e.index),c.lastBreadcrumb===a?!1:(c.lastBreadcrumb=a,void l.productsBreadcrumb.html(m.productsBreadcrumb({breadCrumbProudctCategory:t,breadCrumbProduct:e})))},proceedToOrderByEmail:function(t){t.preventDefault(),c.preventHashChange=!0,h.closeAllModals(),clearTimeout(c.showSubmitRequestTimeout),c.showSubmitRequestTimeout=setTimeout(function(){l.modalContainer.html(m.submitRequestFormModal),h.openModal(),$("#submitRequestForm").validate(),$(".required").on("keyup change",h.validateSubmitRequestForm)},500)},submitRequest:function(e){if(e.preventDefault(),h.validateSubmitRequestForm()){if(c.isDemoActivate)return h.onRequestSubmitted({adminMailSent:1,customerMailSent:1});c.enableOrderBtn=!1;var a=$("#submitRequestForm").serialize(),o=t.submitRequestBaseURL+h.cartProductsURLGeneration()+"&cartLength="+(i.length+1)+"&"+a;$.ajax({url:o,type:"POST",dataType:"JSON"}).done(function(t){h.onRequestSubmitted(t)}).fail(function(){c.enableOrderBtn=!1,_.delay(p.goToTopModel,300),$(".request-page-header").html(t.messages.order.failed_header),$(".request-page-body").html(t.messages.order.failed)})}},onRequestSubmitted:function(e){$(".request-page-header").html(t.messages.order.success_header),(e.customerMailSent||e.adminMailSent)&&$(".request-page-body").html(t.messages.order.success),$("#backToCartBtn, #submitRequestBtn").hide(),$(".request-page-close-btn").show(),i=new Array,h.updateCart(),_.delay(p.goToTopModel,300)},validateSubmitRequestForm:function(){var t=$("#submitRequestForm").valid();return t?$("#submitRequestBtn").removeAttr("disabled"):$("#submitRequestBtn").attr("disabled","disabled"),t},backToCartFromSubmitForm:function(t){t.preventDefault(),h.closeAllModals(),c.preventHashChange=!0,clearTimeout(c.showSubmitRequestTimeout),c.showSubmitRequestTimeout=setTimeout(function(){h.showShoppingCart({preventModelReLoad:!0}),h.openModal()},500)},cartProductsURLGeneration:function(){var t=1,a="";for(var o in i){var r=i[o],n=e[r.index];a+="&item_name_"+t+"="+n.name+"&item_number_"+t+"="+n.id+"&quantity_"+t+"="+r.qty,t++}return a},closeAllModals:function(){l.modalCommon.modal("hide"),$(".modal-backdrop").remove()},openModal:function(){h.closeAllModals(),l.modalCommon.modal()},categoryCalled:function(t){t.u||(t.u="all"),t.u=a[t.u]?t.u:"all",h.loadCategoryProducts(t.u)},productCalled:function(t){if(t.u){if(h.productDetails(t.u),l.mainContainer.addClass("main-container-addtions"),!e[t.u])return h.loadCategoryProducts("all"),!1;var a=e[t.u].categoryIndex;c.isStoreLoaded||h.loadCategoryProducts(a)}else h.loadCategoryProducts("all")},onAllComplete:function(){h.closeAllModals();var e=p.dataFromURL();if(e.hasOwnProperty("category")){if(c.preventHashChangedAction)return c.preventHashChangedAction=!1,!1;h.categoryCalled(e)}else if(e.hasOwnProperty("search")){if(c.preventHashChangedAction)return c.preventHashChangedAction=!1,!1;h.searchProduct()}else e.hasOwnProperty("product")?h.productCalled(e):e.hasOwnProperty("quote-cart")&&t.enableQuoteCart?h.showShoppingCart():h.loadCategoryProducts("all");c.isStoreLoaded||(c.isStoreLoaded=!0)}};$(window).on("hashchange",function(){c.hashChanged=!0,h.onAllComplete()}),$(window).on("resize",p.resizeNPositioin),l.categoriesList.on("click",".category-link",h.categoryLinkAction),l.modalContainer.on("click",".add-to-cart-btn",h.addToCart),l.searchInput.on("keyup",h.onSearch),l.clearSearchBtn.on("click",function(){h.clearSearchResult(!1)}),l.modalContainer.on("keyup change","input.cart-product-qty",h.updateCartItemQty),l.modalContainer.on("click",".delete-product-from-cart",h.removeCartItem),l.modalContainer.on("click","#checkoutSubmitRequestBtn",h.proceedToOrderByEmail),l.modalContainer.on("click","#submitRequestBtn",h.submitRequest),l.modalContainer.on("click","#backToCartBtn",h.backToCartFromSubmitForm),l.goToTop.on("click",p.goToTop),l.productsContainer.on("mouseover",".product-item",h.updateBreadCrumbOnOver),l.productsContainer.on("click",".product-add-to-cart-btn",h.productAddToCart),l.modalCommon.on("hidden hidden.bs.modal",h.backFromModal)});